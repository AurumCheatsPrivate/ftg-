from .. import loader, utils 
from telethon import events 
from telethon.errors.rpcerrorlist import YouBlockedUserError 
from asyncio.exceptions import TimeoutError 
 
 
def register(cb): 
    cb(AnecdoteMod()) 
 
class AnecdoteMod(loader.Module): 
    """–¢—É–ø–∞ –∞–Ω–µ–≥–¥–æ—Ç—ã""" 
    strings = {'name': '–ê–Ω–µ–∫–¥–æ—Ç_tio'} 
 
    async def ancmd(self, message): 
        """–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .an / .an2 
        –ü–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã –Ω—É–∂–µ–Ω –ª—é–±–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç.""" 
        try: 
            text = utils.get_args_raw(message) 
            reply = await message.get_reply_message() 
            chat = "@petrovichjoke_bot" 
            if not text and not reply: 
                await message.edit("<b>–ò—Å–ø–æ–ª—å–∑—É–π –ª—é–±–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç, –±—É–¥—å —Ç–æ –±—É–∫–≤–∞ –∏–ª–∏ —Ç–æ—á–∫–∞ </b>") 
                return 
            if text: 
                await message.edit("<b>–°–µ–∫—É–Ω–¥–æ—á–∫—É...</b>") 
                async with message.client.conversation(chat) as conv: 
                    try: 
                        response = conv.wait_event(events.NewMessage(incoming=True, from_users=1326556336)) 
                        await message.client.send_message(chat,"üòÄ–ê–Ω–µ–∫–¥–æ—Ç") 
                        response = await response 
                    except YouBlockedUserError: 
                        await message.reply("<b>–†–∞–∑–±–ª–æ–∫–∏—Ä—É–π –±–æ—Ç–∞ @petrovichjoke_bot</b>") 
                        return 
                    if not response.text: 
                        await message.edit("<–ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.</b>") 
                        return 
                    await message.delete() 
                    await message.client.send_message(message.to_id, response.text) 
            if reply: 
                await message.edit("<b>–°–µ–∫—É–Ω–¥–æ—á–∫—É...</b>") 
                async with message.client.conversation(chat) as conv: 
                    try: 
                        response = conv.wait_event(events.NewMessage(incoming=True, from_users=1326556336)) 
                        await message.client.send_message(chat, reply) 
                        response = await response 
                    except YouBlockedUserError: 
                        await message.reply("<b>–†–∞–∑–±–ª–æ–∫–∏—Ä—É–π –±–æ—Ç–∞ @petrovichjoke_bot</b>") 
                        return 
                    if not response.text: 
                        await message.edit("<–ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.</b>") 
                        return 
                    await message.delete() 
                    await message.client.send_message(message.to_id, response.text) 
        except TimeoutError: 
            return await message.edit("<b>–û—à–∏–±–∫–∞ 404</b>")
            
    
    
    async def an2cmd(self, message): 
        """–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .an2 + –ª—é–±–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç""" 
        try: 
            text = utils.get_args_raw(message) 
            reply = await message.get_reply_message() 
            chat = "@FlashTownBot" 
            if not text and not reply: 
                await message.edit("<b>–ò—Å–ø–æ–ª—å–∑—É–π –ª—é–±–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç, –±—É–¥—å —Ç–æ –±—É–∫–≤–∞ –∏–ª–∏ —Ç–æ—á–∫–∞ </b>") 
                return 
            if text: 
                await message.edit("<b>–°–µ–∫—É–Ω–¥–æ—á–∫—É...</b>") 
                async with message.client.conversation(chat) as conv: 
                    try: 
                        response = conv.wait_event(events.NewMessage(incoming=True, from_users=388713470)) 
                        await message.client.send_message(chat,"–∞–Ω–µ–∫–¥–æ—Ç") 
                        response = await response 
                    except YouBlockedUserError: 
                        await message.reply("<b>–†–∞–∑–±–ª–æ–∫–∏—Ä—É–π –±–æ—Ç–∞ @FlashTownBot</b>") 
                        return 
                    if not response.text: 
                        await message.edit("<–ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.</b>") 
                        return 
                    await message.delete() 
                    await message.client.send_message(message.to_id, response.text) 
            if reply: 
                await message.edit("<b>–°–µ–∫—É–Ω–¥–æ—á–∫—É...</b>") 
                async with message.client.conversation(chat) as conv: 
                    try: 
                        response = conv.wait_event(events.NewMessage(incoming=True, from_users=388713470)) 
                        await message.client.send_message(chat, reply) 
                        response = await response 
                    except YouBlockedUserError: 
                        await message.reply("<b>–†–∞–∑–±–ª–æ–∫–∏—Ä—É–π –±–æ—Ç–∞ @FlashTownBot</b>") 
                        return 
                    if not response.text: 
                        await message.edit("<–ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.</b>") 
                        return 
                    await message.delete() 
                    await message.client.send_message(message.to_id, response.text) 
        except TimeoutError: 
            return await message.edit("<b>–û—à–∏–±–∫–∞ 404</b>")
